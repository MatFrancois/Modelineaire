---
title: "Gene Expression Prediction Challenge (expred)"
subtitle: "Starting kit"
author: "Azat Aleksanyan, Lucas Chabeau, Matthieu Frabçois, Etienne Hamard"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: false
---

<!-- Paramètres de knittage -->
```{r label="header", echo=FALSE, eval=TRUE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>", fig.width=9, fig.height=6, eval=TRUE, echo=FALSE, results="hide")
```

<!-- Packages utilisés -->
```{r, warning=FALSE}
require(ggplot2)
require(corrplot)
```

<!-- Importation des données -->
```{r}
don <- readRDS("data.rds")
```

<!-- Rapport -->
## A : Méthodes statistiques utilisées

### **Statistiques descriptives**

Nous commençons l'exploration de nos données par l'observation des statistiques élémentaires ainsi que le nombre de valeur manquantes pour chaque variable.

#### **Variables quantitatives**

```{r results = 'quanti'}
# Stats univariées
summary(don[,-c(2:10)])
```

Rien n'a l'air particulièrement alarmant sur les variables quantitatives, nous avons à peu près le même nombre de valeurs manquantes pour chaque gène (autours de 950) et l'âge n'a pas de valeur manquante. Nous ne trouvons pas non plus, de valeurs abérrantes. Seul le gène TUBA3C mérite qu'on fasse un peu plus attention en l'utilisant car dans au moins 50% des cas de notre échantillon il ne s'exprime pas du tout chez le patient observé.

#### **Variables qualitatives**

Ci-dessous un tri à plat de nos variables qualitatives

```{r results = 'quali'}
# Table pour les variables qualitatives
TabMod<-function(x){
  return(table(x,exclude = NULL))
}
apply(X=don[,2:10],MARGIN=2,FUN=TabMod)
```

Nous voyons pas mal de valeurs manquantes sur pas mal de variables ici : cependant, nous n'avons aucune valeur manquante sur la localisation du gène (tissue), son état (tumoral ou normal), le programme suivi par le patient ainsi que son sexe, ces informations vont être intéressantes dans la construction du modèle.

Il y a à peu près autant que d'hommes que de femmes dans notre étude et la grande majorité des tissus présentent une tumeur.


#### **Lien entre les variables**

Avant de commencer une modélisation, il est toujours intéressant de regarder la matrice des corrélations :

```{r, results = 'correlation'}
### Création du squelette de la matrice de corrélation

#Remplissage de 1
cor.m<-matrix(rep(1,length(names(don[,-c(2:10)]))**2),nrow=length(names(don[,-c(2:10)])))

#Noms lignes et colonnes
colnames(cor.m)<-names(don[,-c(2:10)])
rownames(cor.m)<-names(don[,-c(2:10)])

#Remplissage du traingle supérieur de la matrice
for (i in 1:length(combn(names(don[,-c(2:10)]),2)[1,])){
  cor.m[combn(names(don[,-c(2:10)]),2)[1,i],combn(names(don[,-c(2:10)]),2)[2,i]]<-cor(na.omit(don[,c(combn(names(don[,-c(2:10)]),2)[1,i],combn(names(don[,-c(2:10)]),2)[2,i])]))[2]
}

#Remplissage du triangle supérieur de la matrice
for (i in 1:length(combn(names(don[,-c(2:10)]),2)[1,])){
  cor.m[combn(names(don[,-c(2:10)]),2)[1,i],combn(names(don[,-c(2:10)]),2)[2,i]]<-cor(na.omit(don[,c(combn(names(don[,-c(2:10)]),2)[1,i],combn(names(don[,-c(2:10)]),2)[2,i])]))[2]
}

#Remplissage du triangle inférieur de la matrice
for (i in 1:length(names(don[,-c(2:10)]))){
  for(j in 1:length(names(don[,-c(2:10)]))){
    if(cor.m[i,j]==1){cor.m[i,j]<-cor.m[j,i]}
  }
}

corrplot(cor.m)
cor.m
```

Nous avons donc les exprssions des gènes ND2, ND3 et ND4 qui sont positivement très corrélées (corrélation > 0.84 à chaque fois)

Nous devons aussi noter la corrélation entre les expressions des gènes MP3K2 et BRAF (> 0.66) et celle entre MP3K2 et KRAS (> 0.58)


### Méthodes utilisées pour notre modélisation
- Methods: Which function for linear model? (*e.g* lm, aov, rlm, glm, other...), Which model are your main models? (ND2 ~ sex+age+tissue_status)...

## B : Autocritique sur l'évolution de notre score

*For instance* :
For critical variation in your leader board score:

- Evaluation of your model (e.g. explained variance $R^2$, number of parameters...)
- What is your score on codalab?

## C : Interprétation de nos résultats















```{r, eval=FALSE}
# SUPPLEMENTAL 
## Few words about the dataset 
m = lm(as.matrix(d[,gs]) ~ d$age+d$sex+d$tissue+d$tissue_status+d$project)
data = as.matrix(d[,gs])
data[is.na(d[,gs])] = predict(m, d)[is.na(d[,gs])]

pca = prcomp(data, scale=TRUE)
v = pca$sdev * pca$sdev
p = v / sum(v) * 100
layout(matrix(1:6,2, byrow=FALSE), respect=TRUE)
barplot(p)
i=3
j=2
plot(pca$x[,i], pca$x[,j], xlab=paste(sep="", "PC", i, "(", signif(p[i], 3), "%)"), ylab=paste(sep="",  "PC", j, "(", signif(p[j], 3), "%)"), pch=".")
i=1
j=3
plot(pca$x[,i], pca$x[,j], xlab=paste(sep="",  "PC", i, "(", signif(p[i], 3), "%)"), ylab=paste(sep="",  "PC", j, "(", signif(p[j], 3), "%)"), pch=".")
i=1
j=2
plot(pca$x[,i], pca$x[,j], xlab=paste(sep="",  "PC", i, "(", signif(p[i], 3), "%)"), ylab=paste(sep="",  "PC", j, "(", signif(p[j], 3), "%)"))
```

```{r eval=FALSE}
sapply(gs, function(g){
  boxplot(d[[g]] ~ d$tissue, las=2, main=paste(g, "~ tissue"))  
})
```


